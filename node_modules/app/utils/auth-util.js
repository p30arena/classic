var PROC = require('app/procedure');

function generate_token(n) {
    if (typeof n === 'undefined') {
        n = 10;
    }
    var i,
        text = "",
        possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    for (i = 0; i < n; i += 1) {
        text += possible.charAt(Math.floor(Math.random() * possible.length));
    }
    return text;
}

function auth(username, token, msg, callback) {
	PROC.count_user_on_username_token_active(username, token, function (err, count) {
		if (count === 1) {
			callback();
		} else {
			msg.error(0);
		}
	});
}

exports.auth = auth;
exports.generate_token = generate_token;